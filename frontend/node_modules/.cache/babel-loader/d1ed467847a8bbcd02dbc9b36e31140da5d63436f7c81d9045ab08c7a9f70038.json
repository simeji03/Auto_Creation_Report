{"ast":null,"code":"var _jsxFileName = \"/Users/harry/Dropbox/Tool_Development/Auto_Creation_Report/frontend/src/pages/ConversationalReport.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { api } from '../services/api';\nimport { toast } from '../utils/toast';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst ConversationalReport = () => {\n  _s();\n  const navigate = useNavigate();\n  const [session, setSession] = useState(null);\n  const [currentAnswer, setCurrentAnswer] = useState('');\n  const [interimText, setInterimText] = useState('');\n  const [isRecording, setIsRecording] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const [recognition, setRecognition] = useState(null);\n  const [isListening, setIsListening] = useState(false);\n  const isUserStoppedRef = useRef(false);\n  const recognitionInstanceRef = useRef(null);\n  const finalTranscriptRef = useRef('');\n\n  // éŸ³å£°èªè­˜ã®åˆæœŸåŒ–ï¼ˆä¸€åº¦ã ã‘å®Ÿè¡Œï¼‰\n  useEffect(() => {\n    try {\n      if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {\n        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n        const recognitionInstance = new SpeechRecognition();\n        recognitionInstance.continuous = true;\n        recognitionInstance.interimResults = true;\n        recognitionInstance.lang = 'ja-JP';\n        recognitionInstance.maxAlternatives = 1;\n\n        // ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’refã«ä¿å­˜\n        recognitionInstanceRef.current = recognitionInstance;\n        recognitionInstance.onresult = event => {\n          let finalTranscript = '';\n          let interimTranscript = '';\n\n          // ã™ã¹ã¦ã®çµæœã‚’å‡¦ç†ã—ã¦finalã¨interimã‚’åˆ†ã‘ã‚‹\n          for (let i = 0; i < event.results.length; i++) {\n            const result = event.results[i];\n            const transcript = result[0].transcript;\n            if (result.isFinal) {\n              finalTranscript += transcript;\n            } else {\n              interimTranscript = transcript; // æœ€æ–°ã®interimã®ã¿ä¿æŒ\n            }\n          }\n\n          // finalTranscriptãŒå‰å›ã¨ç•°ãªã‚‹å ´åˆã®ã¿æ›´æ–°\n          if (finalTranscript !== finalTranscriptRef.current) {\n            finalTranscriptRef.current = finalTranscript;\n            setCurrentAnswer(finalTranscript);\n          }\n\n          // interimçµæœã‚’æ›´æ–°\n          setInterimText(interimTranscript);\n        };\n        recognitionInstance.onstart = () => {\n          console.log('éŸ³å£°èªè­˜ãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸ');\n          setIsListening(true);\n          setIsRecording(true);\n          setInterimText('');\n          isUserStoppedRef.current = false;\n        };\n        recognitionInstance.onend = () => {\n          console.log('éŸ³å£°èªè­˜ãŒçµ‚äº†ã—ã¾ã—ãŸ');\n          setInterimText('');\n\n          // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ‰‹å‹•ã§åœæ­¢ã—ãŸå ´åˆã¯å†é–‹ã—ãªã„\n          if (isUserStoppedRef.current) {\n            console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåœæ­¢ã—ãŸãŸã‚çµ‚äº†');\n            setIsListening(false);\n            setIsRecording(false);\n            return;\n          }\n\n          // è‡ªç„¶çµ‚äº†ã®å ´åˆã®ã¿å†é–‹\n          if (isListening && !isUserStoppedRef.current) {\n            console.log('è‡ªå‹•å†é–‹ã‚’è©¦ã¿ã¾ã™');\n            setTimeout(() => {\n              if (isListening && !isUserStoppedRef.current) {\n                try {\n                  recognitionInstance.start();\n                } catch (error) {\n                  console.error('éŸ³å£°èªè­˜ã®å†é–‹ã«å¤±æ•—:', error);\n                  setIsListening(false);\n                  setIsRecording(false);\n                }\n              }\n            }, 500);\n          } else {\n            setIsListening(false);\n            setIsRecording(false);\n          }\n        };\n        recognitionInstance.onerror = event => {\n          console.error('éŸ³å£°èªè­˜ã‚¨ãƒ©ãƒ¼:', event.error);\n          if (event.error === 'no-speech') {\n            console.log('éŸ³å£°ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ - ç¶™ç¶šã—ã¾ã™');\n            // no-speechã¯æ­£å¸¸ãªçŠ¶æ…‹ãªã®ã§ç¶™ç¶š\n            return;\n          }\n          if (event.error === 'audio-capture' || event.error === 'not-allowed') {\n            setIsListening(false);\n            setIsRecording(false);\n            setInterimText('');\n            isUserStoppedRef.current = true;\n            toast.error('ãƒã‚¤ã‚¯ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸ');\n            return;\n          }\n          if (event.error === 'aborted') {\n            console.log('éŸ³å£°èªè­˜ãŒä¸­æ–­ã•ã‚Œã¾ã—ãŸ');\n            // abortedã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯çŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢ã—ã¦çµ‚äº†\n            if (!isUserStoppedRef.current) {\n              setIsListening(false);\n              setIsRecording(false);\n            }\n            return;\n          }\n\n          // ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼ã®å ´åˆ\n          console.log('éŸ³å£°èªè­˜ã‚¨ãƒ©ãƒ¼ - å†é–‹ã‚’è©¦ã¿ã¾ã™:', event.error);\n          if (isListening) {\n            setTimeout(() => {\n              if (isListening) {\n                try {\n                  recognitionInstance.start();\n                } catch (error) {\n                  console.error('éŸ³å£°èªè­˜ã®å†é–‹ã«å¤±æ•—:', error);\n                  setIsListening(false);\n                  setIsRecording(false);\n                  setInterimText('');\n                  isUserStoppedRef.current = true;\n                }\n              }\n            }, 500);\n          }\n        };\n        setRecognition(recognitionInstance);\n      }\n    } catch (error) {\n      console.error('éŸ³å£°èªè­˜ã®åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);\n      toast.error('éŸ³å£°èªè­˜ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ');\n    }\n\n    // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°\n    return () => {\n      if (recognitionInstanceRef.current) {\n        try {\n          recognitionInstanceRef.current.stop();\n        } catch (error) {\n          // ç„¡è¦–\n        }\n      }\n    };\n  }, []); // ç©ºã®ä¾å­˜é…åˆ—ã§ä¸€åº¦ã ã‘å®Ÿè¡Œ\n\n  // å¯¾è©±ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®é–‹å§‹\n  const startConversation = async () => {\n    setIsLoading(true);\n    try {\n      const response = await api.post('/conversation/start');\n      setSession(response.data);\n      toast.success('å¯¾è©±å‹æœˆå ±ä½œæˆã‚’é–‹å§‹ã—ã¾ã—ãŸ');\n    } catch (error) {\n      console.error('ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹ã‚¨ãƒ©ãƒ¼:', error);\n      toast.error('ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // éŸ³å£°èªè­˜ã®åœæ­¢é–¢æ•°\n  const stopRecording = () => {\n    console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒéŸ³å£°èªè­˜ã‚’åœæ­¢ã—ã¾ã—ãŸ');\n    isUserStoppedRef.current = true;\n    if (recognitionInstanceRef.current) {\n      try {\n        recognitionInstanceRef.current.stop();\n      } catch (error) {\n        console.error('éŸ³å£°èªè­˜åœæ­¢ã‚¨ãƒ©ãƒ¼:', error);\n      }\n    }\n    setIsListening(false);\n    setIsRecording(false);\n    setInterimText('');\n  };\n\n  // éŸ³å£°èªè­˜ã®é–‹å§‹é–¢æ•°\n  const startRecording = () => {\n    if (!recognitionInstanceRef.current) {\n      toast.error('éŸ³å£°èªè­˜ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');\n      return;\n    }\n    console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒéŸ³å£°èªè­˜ã‚’é–‹å§‹ã—ã¾ã—ãŸ');\n    try {\n      // éŸ³å£°èªè­˜é–‹å§‹æ™‚ã«ç¾åœ¨ã®ç¢ºå®šãƒ†ã‚­ã‚¹ãƒˆã‚’ä¿å­˜\n      finalTranscriptRef.current = currentAnswer;\n      setInterimText('');\n      isUserStoppedRef.current = false;\n      recognitionInstanceRef.current.start();\n      toast.info('éŸ³å£°èªè­˜ã‚’é–‹å§‹ã—ã¾ã—ãŸã€‚è©±ã—ã¦ãã ã•ã„ã€‚');\n    } catch (error) {\n      console.error('éŸ³å£°èªè­˜ã®é–‹å§‹ã«å¤±æ•—:', error);\n      setIsListening(false);\n      setIsRecording(false);\n      setInterimText('');\n      toast.error('éŸ³å£°èªè­˜ã®é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ');\n    }\n  };\n\n  // éŸ³å£°èªè­˜ã®é–‹å§‹/åœæ­¢ãƒˆã‚°ãƒ«\n  const toggleRecording = () => {\n    if (isListening) {\n      stopRecording();\n    } else {\n      startRecording();\n    }\n  };\n\n  // å›ç­”ã®é€ä¿¡\n  const submitAnswer = async () => {\n    if (!currentAnswer.trim() || !session) return;\n    setIsLoading(true);\n    try {\n      const response = await api.post('/conversation/answer', {\n        session_id: session.session_id,\n        answer: currentAnswer.trim(),\n        session_data: session.session_data\n      });\n      const newSession = response.data;\n      setSession(newSession);\n      setCurrentAnswer('');\n      setInterimText('');\n      finalTranscriptRef.current = '';\n\n      // éŸ³å£°èªè­˜ãŒå‹•ä½œä¸­ã®å ´åˆã¯åœæ­¢\n      if (isListening) {\n        stopRecording();\n      }\n      if (newSession.is_complete) {\n        // å¯¾è©±å®Œäº†ã€æœˆå ±ç”Ÿæˆ\n        await generateReport(newSession.session_data);\n      }\n    } catch (error) {\n      console.error('å›ç­”é€ä¿¡ã‚¨ãƒ©ãƒ¼:', error);\n      toast.error('å›ç­”ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // æœˆå ±ã®ç”Ÿæˆ\n  const generateReport = async sessionData => {\n    try {\n      const response = await api.post('/conversation/generate-report', sessionData);\n      toast.success('æœˆå ±ãŒæ­£å¸¸ã«ç”Ÿæˆã•ã‚Œã¾ã—ãŸï¼');\n      navigate(`/reports/${response.data.report_id}`);\n    } catch (error) {\n      console.error('æœˆå ±ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);\n      toast.error('æœˆå ±ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ');\n    }\n  };\n\n  // é€²æ—ç‡ã®è¨ˆç®—\n  const progressPercentage = session ? Math.round(session.progress / session.total_questions * 100) : 0;\n\n  // ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®æ—¥æœ¬èªå\n  const getCategoryName = category => {\n    const categoryNames = {\n      'basic_info': 'åŸºæœ¬æƒ…å ±',\n      'work_time': 'ç¨¼åƒæ™‚é–“',\n      'sales_activities': 'å–¶æ¥­æ´»å‹•',\n      'financial': 'åå…¥',\n      'reflection': 'æŒ¯ã‚Šè¿”ã‚Š',\n      'completed': 'å®Œäº†'\n    };\n    return categoryNames[category] || category;\n  };\n  if (!session) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-white rounded-2xl shadow-xl p-8 max-w-md w-full\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-center\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-6\",\n            children: /*#__PURE__*/_jsxDEV(\"svg\", {\n              className: \"w-10 h-10 text-blue-600\",\n              fill: \"none\",\n              stroke: \"currentColor\",\n              viewBox: \"0 0 24 24\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                strokeLinecap: \"round\",\n                strokeLinejoin: \"round\",\n                strokeWidth: 2,\n                d: \"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 311,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 310,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 309,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n            className: \"text-3xl font-bold text-gray-900 mb-4\",\n            children: \"\\uD83C\\uDFA4 \\u5BFE\\u8A71\\u578B\\u6708\\u5831\\u4F5C\\u6210\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 314,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-gray-600 mb-8\",\n            children: [\"AI\\u304C\\u8CEA\\u554F\\u3092\\u3057\\u307E\\u3059\\u306E\\u3067\\u3001\\u97F3\\u58F0\\u307E\\u305F\\u306F\\u6587\\u5B57\\u3067\\u7B54\\u3048\\u3066\\u304F\\u3060\\u3055\\u3044\\u3002\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 318,\n              columnNumber: 43\n            }, this), \"\\u81EA\\u7136\\u306B\\u4F1A\\u8A71\\u3059\\u308B\\u3060\\u3051\\u3067\\u3001\\u6708\\u5831\\u304C\\u81EA\\u52D5\\u7684\\u306B\\u4F5C\\u6210\\u3055\\u308C\\u307E\\u3059\\u3002\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 317,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: startConversation,\n            disabled: isLoading,\n            className: \"bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors font-semibold\",\n            children: isLoading ? 'æº–å‚™ä¸­...' : 'ğŸ¤ å¯¾è©±ã‚’é–‹å§‹ã™ã‚‹'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 321,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 308,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 307,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 306,\n      columnNumber: 7\n    }, this);\n  }\n  if (session.is_complete) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 flex items-center justify-center p-4\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-white rounded-2xl shadow-xl p-8 max-w-md w-full text-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6\",\n          children: /*#__PURE__*/_jsxDEV(\"svg\", {\n            className: \"w-10 h-10 text-green-600\",\n            fill: \"none\",\n            stroke: \"currentColor\",\n            viewBox: \"0 0 24 24\",\n            children: /*#__PURE__*/_jsxDEV(\"path\", {\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\",\n              strokeWidth: 2,\n              d: \"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 340,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 339,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 338,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"text-2xl font-bold text-gray-900 mb-4\",\n          children: \"\\u5BFE\\u8A71\\u5B8C\\u4E86\\uFF01\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 343,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-gray-600 mb-6\",\n          children: [\"\\u3059\\u3079\\u3066\\u306E\\u8CEA\\u554F\\u306B\\u304A\\u7B54\\u3048\\u3044\\u305F\\u3060\\u304D\\u3001\\u3042\\u308A\\u304C\\u3068\\u3046\\u3054\\u3056\\u3044\\u307E\\u3057\\u305F\\u3002\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 345,\n            columnNumber: 40\n          }, this), \"\\u6708\\u5831\\u3092\\u751F\\u6210\\u3057\\u3066\\u3044\\u307E\\u3059...\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 344,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 348,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 337,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 336,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"min-h-screen bg-gradient-to-br from-purple-50 to-pink-100 p-4\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"max-w-4xl mx-auto\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-white rounded-t-2xl shadow-lg p-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center justify-between mb-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n            className: \"text-2xl font-bold text-gray-900\",\n            children: \"\\u5BFE\\u8A71\\u578B\\u6708\\u5831\\u4F5C\\u6210\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 360,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium\",\n            children: getCategoryName(session.category)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 361,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 359,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mb-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex justify-between text-sm text-gray-600 mb-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"\\u9032\\u6357\\u72B6\\u6CC1\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 369,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [session.progress, \" / \", session.total_questions]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 370,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 368,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"w-full bg-gray-200 rounded-full h-2\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"bg-purple-600 h-2 rounded-full transition-all duration-300\",\n              style: {\n                width: `${progressPercentage}%`\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 373,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 372,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-center text-sm text-gray-500 mt-1\",\n            children: [progressPercentage, \"% \\u5B8C\\u4E86\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 378,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 367,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 358,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-white shadow-lg p-8\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mb-8\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-start space-x-4\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0\",\n              children: /*#__PURE__*/_jsxDEV(\"svg\", {\n                className: \"w-6 h-6 text-blue-600\",\n                fill: \"none\",\n                stroke: \"currentColor\",\n                viewBox: \"0 0 24 24\",\n                children: /*#__PURE__*/_jsxDEV(\"path\", {\n                  strokeLinecap: \"round\",\n                  strokeLinejoin: \"round\",\n                  strokeWidth: 2,\n                  d: \"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 390,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 389,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 388,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex-1\",\n              children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n                className: \"text-lg font-semibold text-gray-900 mb-2\",\n                children: \"\\u8CEA\\u554F\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 394,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-gray-700 text-lg leading-relaxed\",\n                children: session.question\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 395,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 393,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 387,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 386,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"space-y-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"block text-sm font-medium text-gray-700 mb-2\",\n              children: \"\\u3042\\u306A\\u305F\\u306E\\u56DE\\u7B54\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 403,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"relative\",\n              children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n                value: currentAnswer + (interimText ? ' ' + interimText : ''),\n                onChange: e => {\n                  const newValue = e.target.value;\n                  // interimTextã‚’é™¤ã„ãŸéƒ¨åˆ†ã®ã¿ã‚’æ›´æ–°\n                  const interimLength = interimText ? interimText.length + 1 : 0; // ã‚¹ãƒšãƒ¼ã‚¹è¾¼ã¿\n                  const withoutInterim = newValue.slice(0, newValue.length - interimLength);\n                  setCurrentAnswer(withoutInterim);\n                },\n                placeholder: \"\\u3053\\u3053\\u306B\\u56DE\\u7B54\\u3092\\u5165\\u529B\\u3059\\u308B\\u304B\\u3001\\u97F3\\u58F0\\u5165\\u529B\\u30DC\\u30BF\\u30F3\\u3092\\u4F7F\\u7528\\u3057\\u3066\\u304F\\u3060\\u3055\\u3044...\",\n                className: \"w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none\",\n                rows: 4\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 407,\n                columnNumber: 17\n              }, this), interimText && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"absolute top-2 right-2 text-xs text-gray-400 bg-yellow-100 px-2 py-1 rounded\",\n                children: \"\\u97F3\\u58F0\\u8A8D\\u8B58\\u4E2D...\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 421,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 406,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 402,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center justify-between\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center space-x-4\",\n              children: [recognition && /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: toggleRecording,\n                className: `flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ${isRecording ? 'bg-red-600 text-white hover:bg-red-700' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`,\n                children: isRecording ? /*#__PURE__*/_jsxDEV(_Fragment, {\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"w-3 h-3 bg-white rounded-full animate-pulse\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 442,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    children: \"\\u9332\\u97F3\\u505C\\u6B62\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 443,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n                  children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n                    className: \"w-5 h-5\",\n                    fill: \"none\",\n                    stroke: \"currentColor\",\n                    viewBox: \"0 0 24 24\",\n                    children: /*#__PURE__*/_jsxDEV(\"path\", {\n                      strokeLinecap: \"round\",\n                      strokeLinejoin: \"round\",\n                      strokeWidth: 2,\n                      d: \"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 448,\n                      columnNumber: 27\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 447,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    children: \"\\u97F3\\u58F0\\u5165\\u529B\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 450,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 432,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-sm text-gray-500\",\n                children: \"\\u97F3\\u58F0\\u307E\\u305F\\u306F\\u30C6\\u30AD\\u30B9\\u30C8\\u3067\\u56DE\\u7B54\\u3057\\u3066\\u304F\\u3060\\u3055\\u3044\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 456,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 430,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: submitAnswer,\n              disabled: !currentAnswer.trim() || isLoading,\n              className: \"bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\",\n              children: isLoading ? 'é€ä¿¡ä¸­...' : 'æ¬¡ã¸ â†’'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 461,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 429,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 401,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 385,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-gray-50 rounded-b-2xl shadow-lg p-4 text-center text-sm text-gray-600\",\n        children: \"\\uD83D\\uDCA1 \\u81EA\\u7136\\u306B\\u4F1A\\u8A71\\u3059\\u308B\\u3088\\u3046\\u306B\\u7B54\\u3048\\u3066\\u304F\\u3060\\u3055\\u3044\\u3002\\u8A73\\u7D30\\u306A\\u60C5\\u5831\\u307B\\u3069\\u3001\\u3088\\u308A\\u826F\\u3044\\u6708\\u5831\\u304C\\u4F5C\\u6210\\u3055\\u308C\\u307E\\u3059\\u3002\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 473,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 356,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 355,\n    columnNumber: 5\n  }, this);\n};\n_s(ConversationalReport, \"eeONgJdXctwIgN+N7svp648V4d8=\", false, function () {\n  return [useNavigate];\n});\n_c = ConversationalReport;\nexport default ConversationalReport;\nvar _c;\n$RefreshReg$(_c, \"ConversationalReport\");","map":{"version":3,"names":["React","useState","useRef","useEffect","useNavigate","api","toast","jsxDEV","_jsxDEV","Fragment","_Fragment","ConversationalReport","_s","navigate","session","setSession","currentAnswer","setCurrentAnswer","interimText","setInterimText","isRecording","setIsRecording","isLoading","setIsLoading","recognition","setRecognition","isListening","setIsListening","isUserStoppedRef","recognitionInstanceRef","finalTranscriptRef","window","SpeechRecognition","webkitSpeechRecognition","recognitionInstance","continuous","interimResults","lang","maxAlternatives","current","onresult","event","finalTranscript","interimTranscript","i","results","length","result","transcript","isFinal","onstart","console","log","onend","setTimeout","start","error","onerror","stop","startConversation","response","post","data","success","stopRecording","startRecording","info","toggleRecording","submitAnswer","trim","session_id","answer","session_data","newSession","is_complete","generateReport","sessionData","report_id","progressPercentage","Math","round","progress","total_questions","getCategoryName","category","categoryNames","className","children","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","fileName","_jsxFileName","lineNumber","columnNumber","onClick","disabled","style","width","question","value","onChange","e","newValue","target","interimLength","withoutInterim","slice","placeholder","rows","_c","$RefreshReg$"],"sources":["/Users/harry/Dropbox/Tool_Development/Auto_Creation_Report/frontend/src/pages/ConversationalReport.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { api } from '../services/api';\nimport { toast } from '../utils/toast';\n\ninterface ConversationSession {\n  session_id: string;\n  question: string | null;\n  question_type: string;\n  category: string;\n  progress: number;\n  total_questions: number;\n  session_data: any;\n  is_complete: boolean;\n}\n\nconst ConversationalReport: React.FC = () => {\n  const navigate = useNavigate();\n  const [session, setSession] = useState<ConversationSession | null>(null);\n  const [currentAnswer, setCurrentAnswer] = useState('');\n  const [interimText, setInterimText] = useState('');\n  const [isRecording, setIsRecording] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const [recognition, setRecognition] = useState<any>(null);\n  const [isListening, setIsListening] = useState(false);\n  const isUserStoppedRef = useRef(false);\n  const recognitionInstanceRef = useRef<any>(null);\n  const finalTranscriptRef = useRef('');\n\n  // éŸ³å£°èªè­˜ã®åˆæœŸåŒ–ï¼ˆä¸€åº¦ã ã‘å®Ÿè¡Œï¼‰\n  useEffect(() => {\n    try {\n      if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {\n        const SpeechRecognition = (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition;\n        const recognitionInstance = new SpeechRecognition();\n        \n        recognitionInstance.continuous = true;\n        recognitionInstance.interimResults = true;\n        recognitionInstance.lang = 'ja-JP';\n        recognitionInstance.maxAlternatives = 1;\n        \n        // ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’refã«ä¿å­˜\n        recognitionInstanceRef.current = recognitionInstance;\n      \n      recognitionInstance.onresult = (event: any) => {\n        let finalTranscript = '';\n        let interimTranscript = '';\n        \n        // ã™ã¹ã¦ã®çµæœã‚’å‡¦ç†ã—ã¦finalã¨interimã‚’åˆ†ã‘ã‚‹\n        for (let i = 0; i < event.results.length; i++) {\n          const result = event.results[i];\n          const transcript = result[0].transcript;\n          \n          if (result.isFinal) {\n            finalTranscript += transcript;\n          } else {\n            interimTranscript = transcript; // æœ€æ–°ã®interimã®ã¿ä¿æŒ\n          }\n        }\n        \n        // finalTranscriptãŒå‰å›ã¨ç•°ãªã‚‹å ´åˆã®ã¿æ›´æ–°\n        if (finalTranscript !== finalTranscriptRef.current) {\n          finalTranscriptRef.current = finalTranscript;\n          setCurrentAnswer(finalTranscript);\n        }\n        \n        // interimçµæœã‚’æ›´æ–°\n        setInterimText(interimTranscript);\n      };\n      \n      recognitionInstance.onstart = () => {\n        console.log('éŸ³å£°èªè­˜ãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸ');\n        setIsListening(true);\n        setIsRecording(true);\n        setInterimText('');\n        isUserStoppedRef.current = false;\n      };\n      \n      recognitionInstance.onend = () => {\n        console.log('éŸ³å£°èªè­˜ãŒçµ‚äº†ã—ã¾ã—ãŸ');\n        setInterimText('');\n        \n        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ‰‹å‹•ã§åœæ­¢ã—ãŸå ´åˆã¯å†é–‹ã—ãªã„\n        if (isUserStoppedRef.current) {\n          console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåœæ­¢ã—ãŸãŸã‚çµ‚äº†');\n          setIsListening(false);\n          setIsRecording(false);\n          return;\n        }\n        \n        // è‡ªç„¶çµ‚äº†ã®å ´åˆã®ã¿å†é–‹\n        if (isListening && !isUserStoppedRef.current) {\n          console.log('è‡ªå‹•å†é–‹ã‚’è©¦ã¿ã¾ã™');\n          setTimeout(() => {\n            if (isListening && !isUserStoppedRef.current) {\n              try {\n                recognitionInstance.start();\n              } catch (error) {\n                console.error('éŸ³å£°èªè­˜ã®å†é–‹ã«å¤±æ•—:', error);\n                setIsListening(false);\n                setIsRecording(false);\n              }\n            }\n          }, 500);\n        } else {\n          setIsListening(false);\n          setIsRecording(false);\n        }\n      };\n      \n      recognitionInstance.onerror = (event: any) => {\n        console.error('éŸ³å£°èªè­˜ã‚¨ãƒ©ãƒ¼:', event.error);\n        \n        if (event.error === 'no-speech') {\n          console.log('éŸ³å£°ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ - ç¶™ç¶šã—ã¾ã™');\n          // no-speechã¯æ­£å¸¸ãªçŠ¶æ…‹ãªã®ã§ç¶™ç¶š\n          return;\n        }\n        \n        if (event.error === 'audio-capture' || event.error === 'not-allowed') {\n          setIsListening(false);\n          setIsRecording(false);\n          setInterimText('');\n          isUserStoppedRef.current = true;\n          toast.error('ãƒã‚¤ã‚¯ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸ');\n          return;\n        }\n        \n        if (event.error === 'aborted') {\n          console.log('éŸ³å£°èªè­˜ãŒä¸­æ–­ã•ã‚Œã¾ã—ãŸ');\n          // abortedã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯çŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢ã—ã¦çµ‚äº†\n          if (!isUserStoppedRef.current) {\n            setIsListening(false);\n            setIsRecording(false);\n          }\n          return;\n        }\n        \n        // ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼ã®å ´åˆ\n        console.log('éŸ³å£°èªè­˜ã‚¨ãƒ©ãƒ¼ - å†é–‹ã‚’è©¦ã¿ã¾ã™:', event.error);\n        if (isListening) {\n          setTimeout(() => {\n            if (isListening) {\n              try {\n                recognitionInstance.start();\n              } catch (error) {\n                console.error('éŸ³å£°èªè­˜ã®å†é–‹ã«å¤±æ•—:', error);\n                setIsListening(false);\n                setIsRecording(false);\n                setInterimText('');\n                isUserStoppedRef.current = true;\n              }\n            }\n          }, 500);\n        }\n      };\n        \n        setRecognition(recognitionInstance);\n      }\n    } catch (error) {\n      console.error('éŸ³å£°èªè­˜ã®åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);\n      toast.error('éŸ³å£°èªè­˜ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ');\n    }\n    \n    // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°\n    return () => {\n      if (recognitionInstanceRef.current) {\n        try {\n          recognitionInstanceRef.current.stop();\n        } catch (error) {\n          // ç„¡è¦–\n        }\n      }\n    };\n  }, []); // ç©ºã®ä¾å­˜é…åˆ—ã§ä¸€åº¦ã ã‘å®Ÿè¡Œ\n\n  // å¯¾è©±ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®é–‹å§‹\n  const startConversation = async () => {\n    setIsLoading(true);\n    try {\n      const response = await api.post('/conversation/start');\n      setSession(response.data);\n      toast.success('å¯¾è©±å‹æœˆå ±ä½œæˆã‚’é–‹å§‹ã—ã¾ã—ãŸ');\n    } catch (error) {\n      console.error('ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹ã‚¨ãƒ©ãƒ¼:', error);\n      toast.error('ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // éŸ³å£°èªè­˜ã®åœæ­¢é–¢æ•°\n  const stopRecording = () => {\n    console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒéŸ³å£°èªè­˜ã‚’åœæ­¢ã—ã¾ã—ãŸ');\n    isUserStoppedRef.current = true;\n    if (recognitionInstanceRef.current) {\n      try {\n        recognitionInstanceRef.current.stop();\n      } catch (error) {\n        console.error('éŸ³å£°èªè­˜åœæ­¢ã‚¨ãƒ©ãƒ¼:', error);\n      }\n    }\n    setIsListening(false);\n    setIsRecording(false);\n    setInterimText('');\n  };\n\n  // éŸ³å£°èªè­˜ã®é–‹å§‹é–¢æ•°\n  const startRecording = () => {\n    if (!recognitionInstanceRef.current) {\n      toast.error('éŸ³å£°èªè­˜ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');\n      return;\n    }\n\n    console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒéŸ³å£°èªè­˜ã‚’é–‹å§‹ã—ã¾ã—ãŸ');\n    try {\n      // éŸ³å£°èªè­˜é–‹å§‹æ™‚ã«ç¾åœ¨ã®ç¢ºå®šãƒ†ã‚­ã‚¹ãƒˆã‚’ä¿å­˜\n      finalTranscriptRef.current = currentAnswer;\n      setInterimText('');\n      isUserStoppedRef.current = false;\n      recognitionInstanceRef.current.start();\n      toast.info('éŸ³å£°èªè­˜ã‚’é–‹å§‹ã—ã¾ã—ãŸã€‚è©±ã—ã¦ãã ã•ã„ã€‚');\n    } catch (error) {\n      console.error('éŸ³å£°èªè­˜ã®é–‹å§‹ã«å¤±æ•—:', error);\n      setIsListening(false);\n      setIsRecording(false);\n      setInterimText('');\n      toast.error('éŸ³å£°èªè­˜ã®é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ');\n    }\n  };\n\n  // éŸ³å£°èªè­˜ã®é–‹å§‹/åœæ­¢ãƒˆã‚°ãƒ«\n  const toggleRecording = () => {\n    if (isListening) {\n      stopRecording();\n    } else {\n      startRecording();\n    }\n  };\n\n  // å›ç­”ã®é€ä¿¡\n  const submitAnswer = async () => {\n    if (!currentAnswer.trim() || !session) return;\n\n    setIsLoading(true);\n    try {\n      const response = await api.post('/conversation/answer', {\n        session_id: session.session_id,\n        answer: currentAnswer.trim(),\n        session_data: session.session_data\n      });\n\n      const newSession = response.data;\n      setSession(newSession);\n      setCurrentAnswer('');\n      setInterimText('');\n      finalTranscriptRef.current = '';\n      \n      // éŸ³å£°èªè­˜ãŒå‹•ä½œä¸­ã®å ´åˆã¯åœæ­¢\n      if (isListening) {\n        stopRecording();\n      }\n\n      if (newSession.is_complete) {\n        // å¯¾è©±å®Œäº†ã€æœˆå ±ç”Ÿæˆ\n        await generateReport(newSession.session_data);\n      }\n    } catch (error) {\n      console.error('å›ç­”é€ä¿¡ã‚¨ãƒ©ãƒ¼:', error);\n      toast.error('å›ç­”ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // æœˆå ±ã®ç”Ÿæˆ\n  const generateReport = async (sessionData: any) => {\n    try {\n      const response = await api.post('/conversation/generate-report', sessionData);\n      toast.success('æœˆå ±ãŒæ­£å¸¸ã«ç”Ÿæˆã•ã‚Œã¾ã—ãŸï¼');\n      navigate(`/reports/${response.data.report_id}`);\n    } catch (error) {\n      console.error('æœˆå ±ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);\n      toast.error('æœˆå ±ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ');\n    }\n  };\n\n  // é€²æ—ç‡ã®è¨ˆç®—\n  const progressPercentage = session ? Math.round((session.progress / session.total_questions) * 100) : 0;\n\n  // ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®æ—¥æœ¬èªå\n  const getCategoryName = (category: string) => {\n    const categoryNames: { [key: string]: string } = {\n      'basic_info': 'åŸºæœ¬æƒ…å ±',\n      'work_time': 'ç¨¼åƒæ™‚é–“',\n      'sales_activities': 'å–¶æ¥­æ´»å‹•',\n      'financial': 'åå…¥',\n      'reflection': 'æŒ¯ã‚Šè¿”ã‚Š',\n      'completed': 'å®Œäº†'\n    };\n    return categoryNames[category] || category;\n  };\n\n  if (!session) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4\">\n        <div className=\"bg-white rounded-2xl shadow-xl p-8 max-w-md w-full\">\n          <div className=\"text-center\">\n            <div className=\"w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-6\">\n              <svg className=\"w-10 h-10 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z\" />\n              </svg>\n            </div>\n            <h1 className=\"text-3xl font-bold text-gray-900 mb-4\">\n              ğŸ¤ å¯¾è©±å‹æœˆå ±ä½œæˆ\n            </h1>\n            <p className=\"text-gray-600 mb-8\">\n              AIãŒè³ªå•ã‚’ã—ã¾ã™ã®ã§ã€éŸ³å£°ã¾ãŸã¯æ–‡å­—ã§ç­”ãˆã¦ãã ã•ã„ã€‚<br />\n              è‡ªç„¶ã«ä¼šè©±ã™ã‚‹ã ã‘ã§ã€æœˆå ±ãŒè‡ªå‹•çš„ã«ä½œæˆã•ã‚Œã¾ã™ã€‚\n            </p>\n            <button\n              onClick={startConversation}\n              disabled={isLoading}\n              className=\"bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors font-semibold\"\n            >\n              {isLoading ? 'æº–å‚™ä¸­...' : 'ğŸ¤ å¯¾è©±ã‚’é–‹å§‹ã™ã‚‹'}\n            </button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (session.is_complete) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 flex items-center justify-center p-4\">\n        <div className=\"bg-white rounded-2xl shadow-xl p-8 max-w-md w-full text-center\">\n          <div className=\"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6\">\n            <svg className=\"w-10 h-10 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n            </svg>\n          </div>\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">å¯¾è©±å®Œäº†ï¼</h2>\n          <p className=\"text-gray-600 mb-6\">\n            ã™ã¹ã¦ã®è³ªå•ã«ãŠç­”ãˆã„ãŸã ãã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚<br />\n            æœˆå ±ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™...\n          </p>\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto\"></div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-purple-50 to-pink-100 p-4\">\n      <div className=\"max-w-4xl mx-auto\">\n        {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}\n        <div className=\"bg-white rounded-t-2xl shadow-lg p-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h1 className=\"text-2xl font-bold text-gray-900\">å¯¾è©±å‹æœˆå ±ä½œæˆ</h1>\n            <span className=\"bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium\">\n              {getCategoryName(session.category)}\n            </span>\n          </div>\n          \n          {/* é€²æ—ãƒãƒ¼ */}\n          <div className=\"mb-4\">\n            <div className=\"flex justify-between text-sm text-gray-600 mb-2\">\n              <span>é€²æ—çŠ¶æ³</span>\n              <span>{session.progress} / {session.total_questions}</span>\n            </div>\n            <div className=\"w-full bg-gray-200 rounded-full h-2\">\n              <div \n                className=\"bg-purple-600 h-2 rounded-full transition-all duration-300\"\n                style={{ width: `${progressPercentage}%` }}\n              ></div>\n            </div>\n            <div className=\"text-center text-sm text-gray-500 mt-1\">\n              {progressPercentage}% å®Œäº†\n            </div>\n          </div>\n        </div>\n\n        {/* è³ªå•ã‚¨ãƒªã‚¢ */}\n        <div className=\"bg-white shadow-lg p-8\">\n          <div className=\"mb-8\">\n            <div className=\"flex items-start space-x-4\">\n              <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0\">\n                <svg className=\"w-6 h-6 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                </svg>\n              </div>\n              <div className=\"flex-1\">\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">è³ªå•</h3>\n                <p className=\"text-gray-700 text-lg leading-relaxed\">{session.question}</p>\n              </div>\n            </div>\n          </div>\n\n          {/* å›ç­”ã‚¨ãƒªã‚¢ */}\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                ã‚ãªãŸã®å›ç­”\n              </label>\n              <div className=\"relative\">\n                <textarea\n                  value={currentAnswer + (interimText ? ' ' + interimText : '')}\n                  onChange={(e) => {\n                    const newValue = e.target.value;\n                    // interimTextã‚’é™¤ã„ãŸéƒ¨åˆ†ã®ã¿ã‚’æ›´æ–°\n                    const interimLength = interimText ? interimText.length + 1 : 0; // ã‚¹ãƒšãƒ¼ã‚¹è¾¼ã¿\n                    const withoutInterim = newValue.slice(0, newValue.length - interimLength);\n                    setCurrentAnswer(withoutInterim);\n                  }}\n                  placeholder=\"ã“ã“ã«å›ç­”ã‚’å…¥åŠ›ã™ã‚‹ã‹ã€éŸ³å£°å…¥åŠ›ãƒœã‚¿ãƒ³ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„...\"\n                  className=\"w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none\"\n                  rows={4}\n                />\n                {interimText && (\n                  <div className=\"absolute top-2 right-2 text-xs text-gray-400 bg-yellow-100 px-2 py-1 rounded\">\n                    éŸ³å£°èªè­˜ä¸­...\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* éŸ³å£°å…¥åŠ›ã¨ãƒœã‚¿ãƒ³ */}\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center space-x-4\">\n                {recognition && (\n                  <button\n                    onClick={toggleRecording}\n                    className={`flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ${\n                      isRecording \n                        ? 'bg-red-600 text-white hover:bg-red-700' \n                        : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                    }`}\n                  >\n                    {isRecording ? (\n                      <>\n                        <div className=\"w-3 h-3 bg-white rounded-full animate-pulse\"></div>\n                        <span>éŒ²éŸ³åœæ­¢</span>\n                      </>\n                    ) : (\n                      <>\n                        <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z\" />\n                        </svg>\n                        <span>éŸ³å£°å…¥åŠ›</span>\n                      </>\n                    )}\n                  </button>\n                )}\n                \n                <span className=\"text-sm text-gray-500\">\n                  éŸ³å£°ã¾ãŸã¯ãƒ†ã‚­ã‚¹ãƒˆã§å›ç­”ã—ã¦ãã ã•ã„\n                </span>\n              </div>\n\n              <button\n                onClick={submitAnswer}\n                disabled={!currentAnswer.trim() || isLoading}\n                className=\"bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n              >\n                {isLoading ? 'é€ä¿¡ä¸­...' : 'æ¬¡ã¸ â†’'}\n              </button>\n            </div>\n          </div>\n        </div>\n\n        {/* ãƒ•ãƒƒã‚¿ãƒ¼ */}\n        <div className=\"bg-gray-50 rounded-b-2xl shadow-lg p-4 text-center text-sm text-gray-600\">\n          ğŸ’¡ è‡ªç„¶ã«ä¼šè©±ã™ã‚‹ã‚ˆã†ã«ç­”ãˆã¦ãã ã•ã„ã€‚è©³ç´°ãªæƒ…å ±ã»ã©ã€ã‚ˆã‚Šè‰¯ã„æœˆå ±ãŒä½œæˆã•ã‚Œã¾ã™ã€‚\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ConversationalReport;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}